[env:teensy41]
platform           = teensy
board              = teensy41
framework          = arduino
; upload_protocol    = teensy-cli  ; Commented out to use default Teensy Loader

; USB is not required for this build; leave as Serial for debug
build_flags        =
  -DUSB_SERIAL
  -Os                           ; Optimize for size
  -DAUDIO_BLOCK_SAMPLES=64      ; Reduce audio buffer size (default is 128, 64 is good compromise)
  ; -flto                       ; Link-time optimization (disabled to preserve function sections for linker script)
  -fno-exceptions               ; Disable C++ exceptions
  -fno-rtti                     ; Disable run-time type info
  -ffunction-sections           ; Each function in its own section
  -fdata-sections               ; Each data in its own section
  -Wl,--gc-sections             ; Garbage collect unused sections
  -Wl,-Map=.pio/build/teensy41/firmware.map  ; Generate link map
  -DSERIAL_TX_BUFFER_SIZE=64    ; Reduce serial buffer
  -DSERIAL_RX_BUFFER_SIZE=64    ; Reduce serial buffer

; Make sure the official OPL library gets pulled in
lib_deps =
  https://github.com/DhrBaksteen/ArduinoOPL2.git
  SD
  USBHost_t36
  Audio
  adafruit/Adafruit RGB LCD Shield Library@^1.2.1
  adafruit/Adafruit GFX Library@^1.11.9

; Speed up build by using LTO, keep symbols for better error output during bring-up
build_unflags      =
